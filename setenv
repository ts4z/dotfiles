# -*- ksh -*-

#
# Under Mac OSX, starting the X server causes .xinitrc to run,
# but not .bashrc *or* .bash_profile, because these files are only
# run if the shell is run in interactive mode.
#

# Path slicing and dicing.  Remove stupid crap from the path (relative dirs,
# but also nonexistant dirs and duplicates, since we probably just made a
# bunch of those).  This is hard to do in Bourne shell, so I resort to
# a perl hairball called whackpath.  If that can't be found we use
cleanpath ()
{
  for dir in "$HOME/cvs/bin" "$HOME/cvs-tjs/bin" ; do
    if [ -x "${dir}/whackpath" ]; then
      answer=`"${dir}/whackpath" "$@"`
      if [ -n "$answer" ]; then
	# success--output cleaned up PATH setting
	echo "$answer"
	return 0
      fi
      return 0
    fi
  done
  # failed--output the input
  echo "$@"
}

if [ "${TJS_DID_SETENV}"x = x ]; then
  export TJS_DID_SETENV=1

  # mac: import this script for Fink stuff
  if [ -f /sw/bin/init.sh ]; then
    . /sw/bin/init.sh
  fi

  # Add extra crap to the back of the path.  Since I'm now using an
  # external perl script to make this work, I could conceivably do this
  # in the perl script instead, but this way it works even if perl is
  # hosed somehow.
  #

  for dir in \
   /usr/sbin \
   /usr/games \
   /sbin \
   ; do
    PATH="$PATH:$dir"
  done
  for dir in \
   /usr \
   /usr/share \
   /usr/local \
   /usr/local/share \
   ; do
    MANPATH="$MANPATH:${dir}/man"
  done
  for dir in \
   "$HOME" \
   /usr/local \
   /usr/local/X11R6 \
   /usr/local/kde/bin \
   /usr/games \
   /bin \
   /usr \
   /usr/X11R6 \
   ; do
    # duplicates are eliminated below
    PATH="$PATH:${dir}/bin"
    if [ -d "${dir}/share" ]; then
      MANPATH="${MANPATH}:${dir}/share/man"
    else
      MANPATH="${MANPATH}:${dir}/man"
    fi
  done

  export PATH=`cleanpath "${PATH}"`
  export MANPATH=`cleanpath "${MANPATH}"`

  umask 22

  export CVS_RSH=ssh
  export EDITOR=gnuclient
  export PAGER=less
  export VISUAL="${EDITOR}"
  export TJS_TMPDIR="/tmp/tjs"
  if [ -d "${HOME}/cvs-tjs" ]; then
    export TJS_CVS="${HOME}/cvs-tjs"
  else
    export TJS_CVS="${HOME}/cvs"
  fi
  
fi				# end of wrapper for whole script
